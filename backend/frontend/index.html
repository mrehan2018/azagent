<!DOCTYPE html>
<html>
<head>
  <title>GAIEF User Query System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    input { padding: 8px; margin: 5px; width: 200px; }
    button { padding: 8px 15px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
    button:hover { background: #005a87; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>GAIEF User Query System</h1>
  
  <div class="section">
    <h2>Fetch Student Record</h2>
    <input type="text" id="studentId" placeholder="Enter Student ID">
    <button onclick="fetchUser('student')">Fetch Student</button>
  </div>

  <div class="section">
    <h2>Fetch Teacher Record</h2>
    <input type="text" id="teacherId" placeholder="Enter Teacher ID">
    <button onclick="fetchUser('teacher')">Fetch Teacher</button>
  </div>

  <div class="section">
    <h2>Fetch Parent Record</h2>
    <input type="text" id="parentId" placeholder="Enter Parent ID">
    <button onclick="fetchUser('parent')">Fetch Parent</button>
  </div>

  <div class="section">
    <h2>Chat with AI</h2>
    <select id="userRole">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
      <option value="parent">Parent</option>
    </select>
    <input type="text" id="topic" placeholder="Topic">
    <input type="text" id="context" placeholder="Context">
    <button onclick="sendChat()">Send Chat</button>
  </div>

  <div class="section">
    <h2>Health Check</h2>
    <button onclick="checkHealth()">Check System Health</button>
  </div>

  <div class="section">
    <h2>Quick User Lookup</h2>
    <select id="role">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
      <option value="parent">Parent</option>
    </select>
    <input type="text" id="userId" placeholder="Enter User ID">
    <button onclick="lookupUser()">Lookup User</button>
  </div>

  <div class="section">
    <h2>Results</h2>
    <pre id="result"></pre>
  </div>

  <script>
    async function fetchUser(userType) {
      const idField = document.getElementById(`${userType}Id`);
      const id = idField.value.trim();
      
      if (!id) {
        displayResult({ error: `Please enter a ${userType} ID` }, true);
        return;
      }

      try {
        const response = await fetch(`/api/v1/${userType}s/${id}`);
        const data = await response.json();
        
        if (response.ok) {
          displayResult(data, false);
        } else {
          displayResult(data, true);
        }
      } catch (error) {
        displayResult({ error: `Network error: ${error.message}` }, true);
      }
    }

    async function sendChat() {
      const role = document.getElementById('userRole').value;
      const topic = document.getElementById('topic').value.trim();
      const context = document.getElementById('context').value.trim();

      if (!topic || !context) {
        displayResult({ error: 'Please fill in both topic and context' }, true);
        return;
      }

      try {
        const response = await fetch('/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            user_role: role,
            topic: topic,
            context: context
          })
        });

        const data = await response.json();
        displayResult(data, !response.ok);
      } catch (error) {
        displayResult({ error: `Network error: ${error.message}` }, true);
      }
    }

    async function checkHealth() {
      try {
        const response = await fetch('/health');
        const data = await response.json();
        displayResult(data, false);
      } catch (error) {
        displayResult({ error: `Network error: ${error.message}` }, true);
      }
    }

    function displayResult(data, isError) {
      const resultElement = document.getElementById('result');
      resultElement.textContent = JSON.stringify(data, null, 2);
      resultElement.className = isError ? 'error' : 'success';
    }

    // Load health check on page load
    window.onload = function() {
      checkHealth();
    };
  </script>
  <script src="/static/script.js"></script>
</body>
</html>
